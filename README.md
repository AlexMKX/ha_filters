# Auto Area Assign

Пользовательская интеграция Home Assistant, автоматически назначающая области (areas) устройствам, если `object_id` связанных с ними сущностей начинается с алиаса соответствующей области.

## Возможности
- Построение таблицы соответствий на основе имени и алиасов областей.
- Назначение области всем устройствам, для которых найдены подходящие сущности.
- Безопасная обработка случаев, когда устройство уже привязано к области или сущность не имеет устройства.
- Ручной перезапуск алгоритма через сервис Home Assistant.

## Установка
### Через HACS
1. В интерфейсе Home Assistant откройте HACS → Интеграции и нажмите «Пользовательские репозитории».
2. Добавьте репозиторий `https://github.com/OWNER/ha_filters` с типом «Интеграция».
3. Найдите «Auto Area Assign» в списке интеграций HACS и установите её.
4. Перезапустите Home Assistant после установки.

### Вручную
1. Скопируйте каталог `custom_components/auto_area_assign` в директорию `custom_components` вашей установки Home Assistant.
2. Перезапустите Home Assistant.

## Использование
- Интеграция автоматически запускает алгоритм при старте Home Assistant.
- Для ручного запуска используйте сервис `auto_area_assign.refresh` из интерфейса Developer Tools → Services.

## Требования к именованию
- `object_id` сущностей должны начинаться с slug-версии имени или алиаса области. Например, если у вас есть область «Кухня» с алиасом `kitchen`, то сущности `light.kitchen_ceiling` или `switch.kitchen_socket` будут связаны с устройством, которому будет назначена область «Кухня`.

## Тестирование и разработка
Для запуска e2e-тестов требуется установленный пакет `homeassistant`. Установите зависимости и запустите `pytest`:

```bash
pip install -r requirements-test.txt
pytest
```

Подробности реализации и дорожная карта указаны в [TECH_SPEC.md](TECH_SPEC.md).

